<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}IDMS - Intelligent Document Management System{% endblock %}</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-100">
    <!-- Sidebar -->
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div id="sidebar" class="w-64 bg-gray-900 text-white shadow-lg transition-transform duration-300 ease-in-out flex-shrink-0">
            <!-- Logo Section -->
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center space-x-3">
                    <div class="bg-blue-600 p-2 rounded-lg">
                        <i class="fas fa-file-alt text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold">CYBERCORP IDMS</h1>
                        <p class="text-xs text-gray-400 mt-1">Intelligent Document Management System</p>
                    </div>
                </div>
            </div>

            <!-- Navigation Menu -->
            <nav class="mt-6">
                <div class="px-3">
                    <a href="/" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gray-800 hover:text-white mb-2 transition-colors duration-200 {% if request.url.path == '/' %}bg-gray-800 text-white{% endif %}">
                        <i class="fas fa-home mr-3"></i>
                        <span>Dashboard</span>
                    </a>
                    <!-- Upload Documents Menu with Sub-menus -->
                    <div class="mb-2">
                        <button onclick="toggleUploadMenu()" class="flex items-center justify-between w-full px-4 py-3 text-gray-300 hover:bg-gray-800 hover:text-white transition-colors duration-200 {% if request.url.path == '/upload' %}bg-gray-800 text-white{% endif %}">
                            <div class="flex items-center">
                                <i class="fas fa-upload mr-3"></i>
                                <span>Upload Documents</span>
                            </div>
                            <i id="upload-menu-arrow" class="fas fa-chevron-down transition-transform duration-200"></i>
                        </button>
                        <div id="upload-submenu" class="ml-4 mt-1 space-y-1 hidden">
                            <a href="/upload#ai-classification" class="flex items-center px-4 py-2 text-sm text-gray-400 hover:text-white hover:bg-gray-700 transition-colors duration-200">
                                <i class="fas fa-brain mr-2"></i>
                                <span>AI Document Classification</span>
                            </a>
                            <a href="/upload#business-upload" class="flex items-center px-4 py-2 text-sm text-gray-400 hover:text-white hover:bg-gray-700 transition-colors duration-200">
                                <i class="fas fa-briefcase mr-2"></i>
                                <span>Business Documents</span>
                            </a>
                        </div>
                    </div>
                    <a href="/docs" target="_blank" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gray-800 hover:text-white mb-2 transition-colors duration-200">
                        <i class="fas fa-cogs mr-3"></i>
                        <span>API Endpoint</span>
                    </a>
                    <a href="/analytics" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gray-800 hover:text-white mb-2 transition-colors duration-200 {% if request.url.path == '/analytics' %}bg-gray-800 text-white{% endif %}">
                        <i class="fas fa-chart-line mr-3"></i>
                        <span>Analytics</span>
                    </a>
                    <a href="/admin" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gray-800 hover:text-white mb-2 transition-colors duration-200 {% if request.url.path == '/admin' %}bg-gray-800 text-white{% endif %}">
                        <i class="fas fa-database mr-3"></i>
                        <span>Database</span>
                    </a>
                </div>

                <!-- Divider -->
                <div class="border-t border-gray-700 my-4"></div>


                <!-- System Status -->
                <div class="px-3">
                    <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">System Status</h3>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between px-4 py-2 bg-gray-800 rounded-lg">
                            <span class="text-sm text-gray-300">FileNet</span>
                            <span id="filenet-status" class="text-xs text-yellow-400">
                                <i class="fas fa-spinner fa-spin mr-1"></i>Checking...
                            </span>
                        </div>
                        <div class="flex items-center justify-between px-4 py-2 bg-gray-800 rounded-lg">
                            <span class="text-sm text-gray-300">Server</span>
                            <span id="server-status" class="text-xs text-green-400">
                                <i class="fas fa-check-circle mr-1"></i>Running
                            </span>
                        </div>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 text-center">
                        <span id="last-updated">Last updated: --</span>
                    </div>
                </div>
            </nav>

            <!-- Footer -->
            <div class="absolute bottom-0 w-64 p-4 border-t border-gray-700">
                <div class="text-xs text-gray-400 text-center">
                    <p>&copy; 2025 CYBERCORP IDMS</p>
                    <p>Powered by IBM WatsonX AI</p>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Header -->
            <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <!-- Mobile menu button -->
                    <button id="sidebar-toggle" class="lg:hidden text-gray-600 hover:text-gray-900">
                        <i class="fas fa-bars text-xl"></i>
                    </button>

                    <!-- Page Title -->
                    <div>
                        <h2 class="text-2xl font-semibold text-gray-900">{% block page_title %}Dashboard{% endblock %}</h2>
                        <p class="text-sm text-gray-600 mt-1">{% block page_subtitle %}Welcome to IDMS{% endblock %}</p>
                    </div>

                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1 overflow-y-auto bg-gray-50">
                <div class="p-6">
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>
    </div>

    <!-- Mobile Sidebar Overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden"></div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', path='js/main.js') }}"></script>
    <script>
        // Sidebar toggle functionality
        document.getElementById('sidebar-toggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        });

        // Close sidebar when clicking overlay
        document.getElementById('sidebar-overlay').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        });

        // Quick upload modal
        function showQuickUpload() {
            window.location.href = '/upload';
        }

        // Settings modal
        function showSettings() {
            alert('Settings panel coming soon!');
        }

        // Toggle upload submenu
        function toggleUploadMenu() {
            const submenu = document.getElementById('upload-submenu');
            const arrow = document.getElementById('upload-menu-arrow');
            
            if (submenu.classList.contains('hidden')) {
                submenu.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                submenu.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // System status functionality
        function updateSystemStatus() {
            fetch('/api/system-status')
                .then(response => response.json())
                .then(data => {
                    updateStatusElement('watsonx-status', data.watsonx_ai.status, 'WatsonX AI');
                    updateStatusElement('filenet-status', data.filenet.status, 'FileNet');
                    updateStatusElement('server-status', data.server.status, 'Server');
                    
                    // Update last updated time
                    const lastUpdated = document.getElementById('last-updated');
                    if (lastUpdated && data.watsonx_ai.last_check) {
                        const date = new Date(data.watsonx_ai.last_check);
                        lastUpdated.textContent = `Last updated: ${date.toLocaleTimeString()}`;
                    }
                })
                .catch(error => {
                    console.error('Error fetching system status:', error);
                    // Show error status
                    updateStatusElement('watsonx-status', 'error', 'WatsonX AI');
                    updateStatusElement('filenet-status', 'error', 'FileNet');
                });
        }

        function updateStatusElement(elementId, status, serviceName) {
            const element = document.getElementById(elementId);
            if (!element) return;

            // Clear existing content
            element.innerHTML = '';

            let icon, text, colorClass;

            switch (status) {
                case 'online':
                case 'connected':
                case 'running':
                    icon = '<i class="fas fa-check-circle mr-1"></i>';
                    text = status === 'online' ? 'Online' : status === 'connected' ? 'Connected' : 'Running';
                    colorClass = 'text-green-400';
                    break;
                case 'error':
                    icon = '<i class="fas fa-exclamation-triangle mr-1"></i>';
                    text = 'Error';
                    colorClass = 'text-red-400';
                    break;
                default:
                    icon = '<i class="fas fa-question-circle mr-1"></i>';
                    text = 'Unknown';
                    colorClass = 'text-yellow-400';
            }

            element.innerHTML = icon + text;
            element.className = `text-xs ${colorClass}`;
        }

        // Initial status check and periodic updates
        updateSystemStatus();
        setInterval(updateSystemStatus, 30000); // Update every 30 seconds
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
